## ‚úÖ P√≥s-instala√ß√£o do Debian 12 Minimal com Unbound como DNS local

### 1. Logar no sistema rec√©m-instalado

```bash
ip -c a
```

Anote o IP e a interface de rede. Conecte-se via SSH ou PuTTY de outro computador usando o IP e o usu√°rio criado.

---

### 2. Definir senha root e logar como root

```bash
sudo passwd root
su
```

---

### 3. Atualizar e instalar pacotes essenciais + Unbound

```bash
sudo apt update
sudo apt install lighttpd nftables systemd-resolved unbound curl btop cloudflared-y
```

---

### 4. Configurar Unbound com root hints

#### Baixar hints:

```bash
sudo wget https://www.internic.net/domain/named.root -O /var/lib/unbound/root.hints
```

#### Criar configura√ß√£o Unbound:

```bash
sudo nano /etc/unbound/unbound.conf.d/pi-hole.conf
```

Conte√∫do:

```bash
server:
    verbosity: 0
    interface: 127.0.0.1
    port: 5335
    do-ip4: yes
    do-udp: yes
    do-tcp: yes
    do-ip6: yes
    prefer-ip6: no
    edns-buffer-size: 1232
    prefetch: yes
    num-threads: 1
    so-rcvbuf: 1m
    private-address: 192.168.0.0/16
    private-address: 169.254.0.0/16
    private-address: 172.16.0.0/12
    private-address: 10.0.0.0/8
    private-address: fd00::/8
    private-address: fe80::/10
```

#### Iniciar Unbound e testar:

```bash
sudo systemctl restart unbound
sudo dig debian.org @127.0.0.1 -p 5335
```

---

### 5. Configurar IP fixo com systemd-networkd

```bash
sudo nano /etc/systemd/network/10-ethernet.network
```

Substitua `enx00e04c680094` pela sua interface.

```ini
[Match]
Name=enx00e04c680094

[Network]
Address=192.168.1.99/24
Gateway=192.168.1.1
DNS=127.0.0.1
```

> üîÅ Agora que o Unbound est√° funcionando, j√° usamos ele como DNS no pr√≥prio sistema.

---

### 6. Ativar servi√ßos de rede modernos e apontar o resolv.conf

```bash
sudo systemctl enable systemd-networkd --now
sudo systemctl enable systemd-resolved --now
sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
```

---

### 7. Testar se o sistema est√° usando o Unbound

```bash
sudo resolvectl status
```

Deve mostrar `127.0.0.1` como DNS ativo. Voc√™ pode tamb√©m testar:

```bash
sudo ping google.com
sudo dig github.com
```

---

### 8. Configurar firewall com `nftables`

```bash
sudo nano /etc/nftables.conf
```

Conte√∫do:

```bash
#!/usr/sbin/nft -f

table inet filter {
    chain input {
        type filter hook input priority 0;
        policy drop;

        iif "lo" accept
        ct state established,related accept

        tcp dport {22, 53, 80, 443, 4711} accept
        udp dport {53, 67, 123, 546, 547} accept
    }

    chain forward {
        type filter hook forward priority 0;
        policy drop;
    }

    chain output {
        type filter hook output priority 0;
        policy accept;
    }
}
```

Ativar firewall:

```bash
sudo systemctl enable nftables --now
```

---

### 9. Remover pacotes desnecess√°rios do sistema

```bash
sudo apt remove --purge ifupdown network-manager wpasupplicant bluetooth -y
sudo apt autoremove -y
sudo truncate -s 0 /etc/network/interfaces
```
