## Após finalizar a instalação do Debian 12 minimal, no terminal local logar com o usuario criado, verifique o IP e Interface de Rede:

```bash
ip -c a
```

## Usando o IP acima, se conecte via PuTTY em outro computador na mesma rede, usando o usuario criado no momento da instalação e defina senha root:

```bash
sudo passwd root
```

## Logar como root com a senha criada acima:

```bash
su
```

## Baixar unbound curl btop:

```bash
sudo apt install unbound curl btop -y
```

## Config unbound 1:

```bash
sudo wget https://www.internic.net/domain/named.root -qO- | sudo tee /var/lib/unbound/root.hints
```

## Config unbound 2:

```bash
sudo nano /etc/unbound/unbound.conf.d/pi-hole.conf
```

## Config unbound 3:

```bash
server:
    verbosity: 0
    interface: 127.0.0.1
    port: 5335
    do-ip4: yes
    do-udp: yes
    do-tcp: yes
    do-ip6: yes
    prefer-ip6: no
    edns-buffer-size: 1232
    prefetch: yes
    num-threads: 1
    so-rcvbuf: 1m
    private-address: 192.168.0.0/16
    private-address: 169.254.0.0/16
    private-address: 172.16.0.0/12
    private-address: 10.0.0.0/8
    private-address: fd00::/8
    private-address: fe80::/10
```

## Config unbound 4:

```bash
sudo service unbound restart
sudo dig pi-hole.net @127.0.0.1 -p 5335
```

## Configurar Ip Fixo:

```bash
sudo nano /etc/network/interfaces
```

## Colar abaixo de: # The primary network interface:

```bash
allow-hotplug enx00e04c680094
iface enx00e04c680094 inet static
    address 192.168.1.99
    netmask 255.255.255.0
    gateway 192.168.1.1
    dns-nameservers 127.0.0.1
```

## Atualizar TimeZone e atualizar IP ( Nesse momento você sera deslogado do PuTTY:

```bash
sudo timedatectl set-timezone America/Sao_Paulo
sudo systemctl restart networking
```

## Após logar no Ip Fixo, Instalar Pi-hole ( Definir o DNS Local 127.0.0.1#5335 ):

```bash
sudo curl -sSL https://install.pi-hole.net | bash
```

## Definir senha Pi-hole:

```bash
sudo pihole setpassword
```

## Config Local DNS 1:

```bash
sudo nano /etc/resolv.conf
```

## Config Local DNS 2:

```bash
nameserver 127.0.0.1
```

## Fixar Config Local DNS:

```bash
sudo chattr +i /etc/resolv.conf
```

## Instalar Tailscale:

```bash
sudo curl -fsSL https://tailscale.com/install.sh | sh
```

## Forward ipv4 e ipv6:

```bash
sudo echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.d/99-tailscale.conf
sudo echo 'net.ipv6.conf.all.forwarding = 1' | sudo tee -a /etc/sysctl.d/99-tailscale.conf
sudo sysctl -p /etc/sysctl.d/99-tailscale.conf
```

## Executar Tailscale:

```bash
sudo tailscale up
```

## Desligar Tailscale:

```bash
sudo tailscale down
```

## Executar Tailscale:

```bash
sudo tailscale up --accept-dns=false --advertise-routes=192.168.1.0/24 --advertise-exit-node
```

## Validar unbound tailscaled pihole-FTL:

```bash
sudo systemctl status unbound tailscaled pihole-FTL
```

## IPTables (IPv4):

```bash
sudo iptables -I INPUT 1 -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT
sudo iptables -I INPUT 1 -s 192.168.1.0/24 -p tcp --dport 443 -j ACCEPT
sudo iptables -I INPUT 1 -s 127.0.0.0/8 -p tcp --dport 53 -j ACCEPT
sudo iptables -I INPUT 1 -s 127.0.0.0/8 -p udp --dport 53 -j ACCEPT
sudo iptables -I INPUT 1 -s 192.168.1.0/24 -p tcp --dport 53 -j ACCEPT
sudo iptables -I INPUT 1 -s 192.168.1.0/24 -p udp --dport 53 -j ACCEPT
sudo iptables -I INPUT 1 -p udp --dport 67:68 --sport 67:68 -j ACCEPT
sudo iptables -I INPUT 1 -p tcp --dport 4711 -i lo -j ACCEPT
sudo iptables -I INPUT 1 -p udp --dport 123 -j ACCEPT
sudo iptables -I INPUT 1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -I INPUT 1 -i tailscale0 -j ACCEPT
sudo iptables -I OUTPUT 1 -o tailscale0 -j ACCEPT
sudo iptables -I INPUT 1 -i lo -j ACCEPT
sudo iptables -I OUTPUT 1 -o lo -j ACCEPT
sudo iptables -I INPUT 1 -p tcp --dport 22 -j ACCEPT
sudo iptables -t nat -A PREROUTING -s 192.168.1.0/24 -p udp --dport 53 -j DNAT --to-destination 192.168.1.99:53
sudo iptables -t nat -A PREROUTING -s 192.168.1.0/24 -p tcp --dport 53 -j DNAT --to-destination 192.168.1.99:53
sudo iptables -t nat -A POSTROUTING -o enx00e04c680094 -j MASQUERADE
sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -P OUTPUT ACCEPT
```

## Salvar regras:

```bash
sudo apt install iptables-persistent
```

## Atualizar Tudo e Limpar:

```bash
sudo apt update && sudo apt full-upgrade -y && sudo apt autoremove -y && sudo apt autoclean
```
